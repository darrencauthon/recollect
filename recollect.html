<!doctype html>
<html>
<head>
    <title>Network | Dynamic Data</title>
    <script src="underscore-min.js" type="text/javascript"></script>
    <script src="vis.min.js" type="text/javascript"></script>
    <script src="jquery-3.3.1.min.js" type="text/javascript"></script>
    <link href="vis.min.css" rel="stylesheet" type="text/css" media="all" />
    <link href="style.css" rel="stylesheet" type="text/css" media="all" />
</head>

<p>
    You can change any settings you want while the network is initialized using the vis Dataset, setOptions and setData. Finally you can destroy the network and completely reinitialize it.
</p>

<h4>DataSet (change the data while it's loaded and initialzed):</h4>
Type in the new element here:  <input id="newThing" type="text" value=""> <br />
<input type="button" onclick="addNode($('#newThing').val())" value="add node dynamically"> <br />
<input type="button" onclick="changeNode1()" value="change node 1's color dynamically"> <br />
<input type="button" onclick="removeRandomNode()" value="remove a random Node"> <br />
<input type="button" onclick="resetAllNodes()" value="reload all nodes"> <br />
<input type="button" onclick="resetAllNodesStabilize()" value="reload all nodes and stabilize"> <br />

<h4>setOptions (change the global options):</h4>
<input type="button" onclick="changeOptions()" value="change the global options"><br />

<h4>setData (reinitialize the data): </h4>
<input type="button" onclick="setTheData()" value="setData. This stabilizes again if stabilization is true."><br />

<h4>Cleanly destroy the network and restart it:</h4>
<input type="button" onclick="resetAll()" value="Destroy the network and restart it."><br />
<div id="recollect-input" class="network"></div>
<div id="recollect-output" class="network"></div>
<input id='recollect-text-input' placeholder="Recollect..." />

<script type="text/javascript">
    var nodeIds, shadowState, nodes, edgesArray, edges, network;

    var nodesArray;

    var getAllRecordsVisibleOnTheDisplay = function() {
        var records = [];
        nodesArray.map((record, _) => {
            records.push({ id: record.id });
        });
        return records;
    };

    var getAllRelationships = function() {
         return [
            { from: 'BBC News', to: 'Facebook' },
            { from: 'CTO', to: 'Cambridge Analytics' }
        ];
    }

    var getAllRecords = function() {
        return [
            { id: 'BBC News' },
            { id: '7/21/2017' },
            { id: '6/1/2017' },
            { id: 'Facebook' },
            { id: 'One trillion social media posts' },
            { id: 'CTO' },
            { id: 'Chris Bingham' },
            { id: 'Crimson Hexagon' },
            { id: 'Cambridge Analytics' },
            { id: 'Zuckerberg testifies before Congress' },
        ];
    };

    var displayTheseRecords = function(records) {
        nodesArray = records.map(record => {
            return _.extend(
                { id: record.id, shape: 'box', label: record.id },
                record.options
            );
        });
    }

    function startNetwork(filter) {

        // this list is kept to remove a random node.. we do not add node 1 here because it's used for changes
        nodeIds = [2, 3, 4, 5];
        shadowState = false;

        // create an array with nodes
        displayTheseRecords(getAllRecords());

        nodes = new vis.DataSet(nodesArray);

        var relationships = getAllRelationships();

        edges = new vis.DataSet(relationships);

        // create a network
        var inputContainer = document.getElementById('recollect-input');
        var outputContainer = document.getElementById('recollect-output');
        var data = {
            nodes: nodes,
            edges: edges
        };

        var options = {
            interaction:{hover:true},
            manipulation: {
                enabled: true
            },
            "edges": {
                "smooth": false
            },
            "physics": {
                "barnesHut": {
                    "gravitationalConstant": -7650,
                    "centralGravity": 0.4,
                    "springLength": 0,
                    "springConstant": 0,
                    "damping": 1
                },
                "maxVelocity": 8,
                "minVelocity": 0.75
            }
        };

        inputNetwork = new vis.Network(inputContainer, data, options);

        var data = {
            nodes: nodes,
            edges: []
        };
        outputNetwork = new vis.Network(outputContainer, data, options);
    }

    var clusters = [];

    function addNode(id) {
        nodes.add({id:id, label:id, shape: 'box'});
        nodeIds.push(id);
    }

    function changeNode1() {
        var newColor = '#' + Math.floor((Math.random() * 255 * 255 * 255)).toString(16);
        nodes.update([{id:1, color:{background:newColor}}]);
    }

    function removeRandomNode() {
        var randomNodeId = nodeIds[Math.floor(Math.random() * nodeIds.length)];
        nodes.remove({id:randomNodeId});

        var index = nodeIds.indexOf(randomNodeId);
        nodeIds.splice(index,1);
    }

    function changeOptions() {
        shadowState = !shadowState;
        network.setOptions({nodes:{shadow:shadowState},edges:{shadow:shadowState}});
    }

    function resetAllNodes() {
        nodes.clear();
        edges.clear();
        nodes.add(nodesArray);
        edges.add(edgesArray);
    }

    function resetAllNodesStabilize() {
        resetAllNodes();
        network.stabilize();
    }

    function setTheData() {
        nodes = new vis.DataSet(nodesArray);
        edges = new vis.DataSet(edgesArray);
        network.setData({nodes:nodes, edges:edges})
    }

    function resetAll() {
        if (network !== null) {
            network.destroy();
            network = null;
        }
        startNetwork();
    }

    startNetwork();
</script>
</body>
<script src="recollect.js" type="text/javascript"></script>
</html>
